{% extends 'site_template.html' %}

{% block imports %}
    <link href="../static/css/my_css/search.css" rel="stylesheet">

{% endblock %}

{% block body %}

    <div id="page-wrapper">
    <div class="container-fluid">

        <!-- Page Heading -->
        <div class="row">
            <div class="col-lg-12">
                {% with messages = get_flashed_messages() %}
                    {% if messages %}
                        {% for message in messages %}
                            <div class="alert alert-info" role="alert">
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
            </div>
        </div>
        {% if not results %}
            <hgroup class="mb20">
                <h1>Search Results</h1>
                <h2 class="lead"><strong class="text-danger">No</strong> results were found for the query:
                    <strong class="text-danger">{{ keywords }}</strong></h2>
            </hgroup>
        {% else %}
            <hgroup class="mb20">
                <h1>Search Results</h1>
                <h2 class="lead"><strong class="text-success">{{ results|length }}</strong> results were found for
                    the query: <strong class="text-success">{{ keywords }}</strong></h2>
            </hgroup>
            <div class="row">
                <div class="col-12 col-xl-12 mb-4 mb-lg-0">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col"></th>
                                    <th scope="col">Document</th>
                                    <th scope="col">Score</th>
                                </tr>
                                <tbody>
                                {% for hit in results.get('hits', []) %}
                                    <tr>
                                        <td class="col-md-2">
                                            <select class="form-select" aria-label="Default select example">
                                                <option selected disabled>Relevances</option>
                                                <option class="relevant" value="1">Relevant</option>
                                                <option class="irrelevant" value="0">Irrelevant</option>
                                            </select>
                                        </td>
                                        <td>
                                            <div class="widget-doc-title">
                                                Documento: <a class="open-file"
                                                              data-url="/collection/{{ collection_name }}/{{ hit['name'] }}">{{ hit['name'] }}</a>
                                                <p class="widget-summary">
                                                    {% if hit['summary'] %}
                                                    {{ hit['summary']|safe }}...
                                                    {% endif %}
                                                </p>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="widget-score-salary"> {{ "%.2f"|format(hit['score']|float) }} </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        {% endif %}
        </div>
    </div>

    <!--Exibição do arquivo-->
    <div class="file-exhibition">
        {% include "file-show.html" %}
    </div>
{% endblock %}

{% block footer %}
    <script type="text/javascript">
    $("a.open-file").click(function(){
        $.ajax({
            url: $(this).data("url"),
            type: 'get',
            success: function(response){
                $(".file-exhibition").html(response);
                var rdeditor = ace.edit("readonly-editor", {
                   wrap:1
                });
                var JsonMode = ace.require("ace/mode/json").Mode;
                rdeditor.session.setMode(new JsonMode());
                rdeditor.renderer.setShowGutter(false);
                rdeditor.setShowPrintMargin(false);
                rdeditor.setHighlightActiveLine(false);
                rdeditor.setReadOnly(true);
                rdeditor.setOptions({
                    fontFamily: "IBM Plex Mono",
                });
                rdeditor.setValue(rdeditor.getValue().trim());
                $("#file-show").modal('show');
            }
        });
    });

    $(".form-select").change(function(){
        const v =  this.value;

        console.log(v);

        if (v == 0) {
            $(this).removeClass("relevant");
            $(this).addClass("irrelevant");
        } else {
            $(this).removeClass("irrelevant");
            $(this).addClass("relevant"); 
        }
    });


    </script>
{% endblock %}